---
title: Who are Bufferâ€™s Target Customers?
author: ''
date: '2018-12-04'
slug: who-are-buffer-s-target-customers
categories: []
tags: []
---

In the beginning of October 2018 we ran a [survey](https://paper.dropbox.com/doc/Target-Customer-Breakdown-Survey-Design-Usage-Analysis--APEa4MfJXOTgIiRGv5bKCgcTAg-IRQFYIt6uF2BDuVKIj4bv) to get a better understanding of how our target customers use Buffer. In this analysis, we'll examine these users' usage patterns on different levels. 

We'll import the raw responses from [this spreadsheet](https://docs.google.com/spreadsheets/d/1zWndjJspBQCSCC6NDZAmB9gTy_G35TJwAFy-dXDJKMo/edit#gid=1451785594).

## Summary
**Agencies** are the most likely to be paying for Buffer and have a relatively low churn rate. 

**Digital brands** are not as likely to be paying customers as agencies or offline brands, but are slightly more likely than Publishers to be paying customers. Digital brands have the highest churn rates of all of the customer segments. 

**Publishers** are the least likely to be paying customers and have a relatively low churn rate.

**Offline brands** are less likely to be paying customers than agencies but are more likely to be paying than digital brands or publishers. Offline brands have the lowest churn rates of all of the customer segments.

```{r include = FALSE, warning = FALSE, message = FALSE}
# load libraries
library(buffer)
library(dplyr)
library(tidyr)
library(stringr)
library(dbplyr)
library(ggplot2)
library(scales)
```

```{r eval = FALSE}
# read data from csv
users <- read.csv('~/Downloads/target_customers.csv', header = TRUE, stringsAsFactors = FALSE)
```

```{r eval = FALSE, include = FALSE}
# rename columns
colnames(users) <- c('user_id', 'plan', 'company_type', 'has_social_manager', 
                     'client_brand_type', 'other_brand_type', 'company_description')

# join awesome and new_awesome
users <- users %>% 
  mutate(plan = gsub("pro", "awesome", plan),
         plan = gsub("awesome", "awesome/pro", plan),
         plan = gsub("new_awesome/pro", "awesome/pro", plan),
         plan = gsub("new_awesome", "awesome/pro", plan),
         plan = gsub("enterprise600", "enterprise", plan),
         plan = gsub("enterprise200", "enterprise", plan))
```

```{r include = FALSE}
# save data
# saveRDS(users, file = 'target_customers.rds')

# load data
users <- readRDS('target_customers.rds')
```

## Exploratory analysis
Let's begin by taking a look at the types of plans that these users were on when they filled out the survey.

```{r echo = FALSE}
# plot plan counts
users %>% 
  count(plan) %>% 
  mutate(plan = reorder(plan, n)) %>% 
  ggplot(aes(x = plan, y = n)) +
  geom_bar(stat = 'identity') +
  coord_flip() +
  buffer_theme() +
  labs(y = "Users", x = NULL, title = "Responses by Plan Type")
```

We can see that most of the responses came from free users. 

```{r echo = FALSE}
# plot plan counts
users %>% 
  filter(company_type != "") %>% 
  count(company_type) %>% 
  mutate(company_type = reorder(company_type, n)) %>% 
  ggplot(aes(x = company_type, y = n)) +
  geom_bar(stat = 'identity') +
  coord_flip() +
  buffer_theme() +
  labs(y = "Users", x = NULL, title = "Responses by Company Type")
```

We had a good number of responses from each company type. Now let's try to see if each type of company is more or less likely to be on a paid plan.

```{r}
# determine if on paid plan
users <- users %>% 
  mutate(on_paid_plan = ifelse(plan == "free", "no", "yes"))
```

```{r echo = FALSE}
ratios <- users %>%
  count(company_type, on_paid_plan) %>%
  group_by(company_type) %>%
  filter(sum(n) >= 10) %>%
  ungroup() %>%
  spread(on_paid_plan, n, fill = 0) %>%
  mutate_if(is.numeric, funs((. + 1) / (sum(.) + 1))) %>%
  mutate(logratio = log(yes / no)) %>%
  arrange(desc(logratio))

# plot ratios
ratios %>%
  mutate(company_type = reorder(company_type, logratio)) %>%
  ggplot(aes(company_type, logratio, fill = logratio < 0)) +
  geom_bar(stat = 'identity') +
  coord_flip() +
  labs(x = NULL, y = "Log Odds Ratio", title = "Relative Likelihood of Being on Paid Plan",
       subtitle = "Agencies are most likely to be on a paid Publish plan") +
  ylab("Log Odds Ratio") +
  buffer_theme() +
  scale_fill_discrete(name = "", labels = c("More Likely Paying", "More Likely Free"))
```

Based on this graph, we can see that Agencies are most likely to be on paid plans, whereas Publishers and those that answered with "Other" are the least likely. Now let's make the same chart but look at the likelihood of users being on _business_ plans.

```{r echo = FALSE}
ratios <- users %>%
  mutate(on_business_plan = ifelse(plan != "free" & plan != "awesome/pro", "yes", "no")) %>% 
  count(company_type, on_business_plan) %>%
  group_by(company_type) %>%
  filter(sum(n) >= 10) %>%
  ungroup() %>%
  spread(on_business_plan, n, fill = 0) %>%
  mutate_if(is.numeric, funs((. + 1) / (sum(.) + 1))) %>%
  mutate(logratio = log(yes / no)) %>%
  arrange(desc(logratio))

# plot ratios
ratios %>%
  mutate(company_type = reorder(company_type, logratio)) %>%
  ggplot(aes(company_type, logratio, fill = logratio < 0)) +
  geom_bar(stat = 'identity') +
  coord_flip() +
  labs(x = NULL, y = "Log Odds Ratio", title = "Relative Likelihood of Being on Business Plan",
       subtitle = "Agencies are most likely to be on a business plan") +
  ylab("Log Odds Ratio") +
  scale_fill_discrete(name = "", labels = c("More Likely B4B", "More Likely not B4B")) +
  buffer_theme()
```

Agencies are the most likely to be on Business plans, and digital brands and publishers are less likely.

## Churn Rates
We'll gather the _current_ plans for each of these users to see how many of them have churned since October. We'll join the users' current plans into the original dataframe that includes the plan at the time the survey was filled out.

```{r eval = FALSE, include = FALSE}
# connect to redshift
con <- redshift_connect()

# get user ids from users dataframe
user_ids <- build_sql(users$user_id)

# sql query
plan_query <- "

  select
    u.id as user_id
    , u.billing_plan_name as current_plan
  from dbt.users as u
  where u.id in user_id_list
  group by 1,2

"

# final query
final_query <- gsub("user_id_list", user_ids, sprintf(plan_query))
  
# query redshift
user_plans <- query_db(final_query, con)
```

```{r include = FALSE}
# save data
# saveRDS(user_plans, file = 'target_customer_current_plans.rds')

# load data
user_plans <- readRDS('target_customer_current_plans.rds')
```

```{r}
# join current plans in to users dataframe
users <- users %>% 
  inner_join(user_plans, by = "user_id")

# determine if user churned
users <- users %>% 
  mutate(churned = plan != "free" & current_plan == "individual")
```

Now we can plot the churn rates of each segment.

```{r echo = FALSE}
users %>% 
  filter(plan != "free") %>% 
  group_by(company_type, churned) %>% 
  summarise(users = n_distinct(user_id)) %>% 
  filter(!is.na(churned) & company_type != "") %>% 
  mutate(churn_rate = users / sum(users)) %>% 
  filter(churned) %>% 
  ungroup() %>% 
  mutate(company_type = reorder(company_type, churn_rate)) %>% 
  ggplot(aes(x = company_type, y = churn_rate)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  buffer_theme() + 
  scale_y_continuous(labels = percent) +
  labs(x = NULL, y = NULL, title = "Churn Rates by Customer Segment",
       subtitle = "Digital brands have the highest churn rate, offline brands have the lowest")
```

It seems that digital brands churned at the highest rate, followed by agencies, publishers, and offline brands, which churned at the lowest rate.

## Online First Consumer Brands (January Update)
In December we ran a product market fit survey to 50% of all Buffer users. The results of that survey were collected in [this spreadsheet](https://docs.google.com/spreadsheets/d/16wOiRP_oUjgmpAqFtsI7rUKKhcqr7GWhGHpsa4Rzr3A/edit#gid=1589765494). We'll download the results as CSVs and import them to our R session.

```{r warning = FALSE, message = FALSE, eval = FALSE}
library(readr)

# read data as csv and add column
free <- read_csv("~/Downloads/pm_fit_free.csv", col_names = FALSE) %>% mutate(plan = "free")
pro <- read_csv("~/Downloads/pm_fit_pro.csv", col_names = FALSE) %>% mutate(plan = "pro")
biz <- read_csv("~/Downloads/pm_fit_business.csv", col_names = FALSE) %>% mutate(plan = "business")

# combine dataframes
results <- free %>% 
  bind_rows(pro) %>% 
  bind_rows(biz) %>% 
  mutate(target_customer = X19 == "Sell our products/services directly to consumers" &
           X20 == "Online store")

# remove unneeded data rames
rm(free)
rm(pro)
rm(biz)
```

Now let's extract the profile id from each response.

```{r eval = FALSE}
# extract profile id
results <- results %>% 
  mutate(profile_id = str_extract(X5, "/profile/(.+?)/"),
         profile_id = gsub("/", "", profile_id),
         profile_id = gsub("profile", "", profile_id))
```

Now we can gather the user ids from the profile ids. 

```{r eval = FALSE}
# connect to redshift
con <- redshift_connect()

# get distinct profile ids
profile_ids <- results %>% 
  group_by(profile_id) %>% 
  summarise(n = n()) %>% 
  ungroup()
 
# get user ids from users dataframe
profile_ids <- build_sql(profile_ids$profile_id)

# sql query
query <- "

  select
    p.id as profile_id
    , p.user_id as user_id
    , u.billing_plan_name as plan_name
    , p.service as service
    , pf.number_of_active_profiles
    , tf.number_of_team_members
  from dbt.profiles as p
  inner join dbt.users as u
    on p.user_id = u.id
  left join dbt.user_profile_facts as pf
    on p.user_id = pf.user_id
  left join dbt.user_team_member_facts as tf
    on p.user_id = tf.user_id
  where p.id in profile_id_list
  group by 1,2,3,4,5,6

"

# final query
final_query <- gsub("profile_id_list", profile_ids, sprintf(query))
  
# query redshift
users <- query_db(final_query, con)

# set counts as ints
users$number_of_active_profiles <- as.integer(users$number_of_active_profiles)
users$number_of_team_members <- as.integer(users$number_of_team_members)

# join it back into the results
user_results <- results %>% 
  inner_join(users, by = "profile_id")
```

```{r include = FALSE}
# save results
# saveRDS(user_results, file = "pm_survey_results.rds")

# load data
results <- readRDS("pm_survey_results.rds")
```

Now let's plot the distribution of the number of profiles that target customers have. 

```{r echo = FALSE}
# plot distribution of profiles
results %>% 
  filter(target_customer) %>% 
  group_by(user_id, plan_name) %>% 
  summarise(profiles = median(number_of_active_profiles, na.rm = TRUE)) %>% 
  ggplot(aes(x = profiles, color = plan_name, fill = plan_name)) +
  geom_histogram(binwidth = 1) +
  buffer_theme() +
  facet_wrap(~plan_name)
```

```{r}
results %>% 
  filter(plan_name == "small" & number_of_active_profiles > 25) %>% 
  select(user_id, plan_name, number_of_active_profiles)
```

